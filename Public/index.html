<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI PWA Generator</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" type="image/png" href="icon.png" />
</head>
<body>
  <main>
    <h1>üß† AI PWA Generator</h1>
    <p>Describe the app you want and let the AI generate a PWA.</p>

    <textarea id="prompt" rows="5" placeholder="e.g., A weather app that shows local forecasts and works offline..."></textarea>
    <button id="generateBtn">‚öôÔ∏è Generate PWA</button>

    <pre id="log">üîç Waiting for your prompt...</pre>
  </main>

  <script>
    const promptInput = document.getElementById("prompt");
    const generateBtn = document.getElementById("generateBtn");
    const log = document.getElementById("log");

    generateBtn.addEventListener("click", async () => {
      const userPrompt = promptInput.value.trim();
      if (!userPrompt) return alert("Please enter a prompt first.");

      log.textContent = "üß† Clarifying your idea...";

      try {
        // Step 1: Clarify
        const clarifyRes = await fetch("/.netlify/functions/agent.js", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ action: "clarify", prompt: userPrompt })
        });
        const clarifyData = await clarifyRes.json();
        const refinedPrompt = clarifyData.content;

        log.textContent = "üõ† Generating PWA files...\n\n" + refinedPrompt;

        // Step 2: Generate
        const generateRes = await fetch("/.netlify/functions/mindsdb-chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ action: "generate", prompt: refinedPrompt })
        });
        const generateData = await generateRes.json();
        const files = generateData.content;

        // Show a simple log (or extend this to download or preview)
        log.textContent = `‚úÖ Generated PWA Files:
- index.html
- app.js
- manifest.json
- service-worker.js
- style.css

üìÑ index.html preview:

${files.html.slice(0, 400)}...
`;
      } catch (err) {
        log.textContent = `‚ùå Error: ${err.message}`;
        console.error(err);
      }
    });
  </script>
</body>
</html>
